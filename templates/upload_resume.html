<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Upload Resume | CareerConnect</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  </head>
  <body class="auth-page" style="background: #f5f7fb;">
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-lg-6">
          <div class="card shadow-sm">
            <div class="card-body p-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                  <h4 class="mb-1">Upload / Replace Resume</h4>
                  <p class="text-muted mb-0">Allowed: pdf, doc, docx, txt (max 5 MB)</p>
                </div>
                <a href="{{ url_for('seeker_dashboard') }}" class="btn btn-outline-secondary btn-sm">Back</a>
              </div>

              {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                  {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }}">{{ message }}</div>
                  {% endfor %}
                {% endif %}
              {% endwith %}

              {% if resume %}
                <div class="mb-3">
                  <label class="form-label">Current uploaded resume</label>
                  <div class="d-flex align-items-center gap-2">
                      <span>{{ resume.original_filename or resume.filename }}</span>
                      <small class="text-muted">(replace by choosing a new file below)</small>
                    </div>
                </div>
              {% endif %}

              {% if analysis %}
                <div class="card mb-3">
                  <div class="card-body small">
                    <div><strong>ATS Score:</strong> {{ analysis.ats.ats_score }}</div>
                    <div><strong>Extracted skills:</strong> {{ analysis.extracted_skills | join(', ') }}</div>
                    <div><strong>Missing skills for selected role:</strong>
                      {% if role_missing is not none %}
                        {{ role_missing | join(', ') if role_missing else 'None or no mapping' }}
                      {% else %}
                        Role not selected
                      {% endif %}
                    </div>
                    {% if analysis.suggestions %}
                      <div><strong>Suggestions:</strong> {{ analysis.suggestions | join('; ') }}</div>
                    {% endif %}
                    {% if role_suggestions %}
                      <div><strong>Suggestions for selected role:</strong> {{ role_suggestions | join('; ') }}</div>
                    {% endif %}
                  </div>
                </div>
              {% endif %}

              <form method="POST" enctype="multipart/form-data" action="{{ url_for('upload_resume') }}">
                <div class="mb-3">
                  <label for="job_role" class="form-label">Target job role (select or type)</label>
                  <input list="role-list" name="job_role" id="job_role" class="form-control" placeholder="e.g. backend, data_scientist" value="{{ selected_role or '' }}" />
                  <datalist id="role-list">
                    {% for r in role_options or [] %}
                      <option value="{{ r }}"></option>
                    {% endfor %}
                  </datalist>
                </div>
                <div class="mb-3">
                  <label for="resume" class="form-label">Choose resume file</label>
                  <input class="form-control" type="file" id="resume" name="resume" accept=".pdf,.doc,.docx,.txt" />
                  <div class="form-text" id="selected-file" style="margin-top:6px;color:#374151;">{% if resume %}Current: {{ resume.original_filename or resume.filename }}{% else %}No file chosen{% endif %}</div>
                </div>
                <div class="d-flex justify-content-end gap-2">
                  <a class="btn btn-outline-secondary" href="{{ url_for('seeker_dashboard') }}">Cancel</a>
                  <button type="submit" class="btn btn-primary">Upload</button>
                </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const input = document.getElementById('resume');
      const label = document.getElementById('selected-file');
      if (input) {
        input.addEventListener('change', function(e) {
          const f = e.target.files && e.target.files[0];
          if (f) {
            label.textContent = 'Selected: ' + f.name;
          } else {
            label.textContent = 'No file chosen';
          }
        });
      }
    </script>

    
  </body>
</html>
